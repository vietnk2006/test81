<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>IELTS Listening ‚Äì 40 Questions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 980px;
      margin: auto;
      padding: 20px;
    }
    h2 { margin-bottom: 5px; }
    .note {
      font-weight: bold;
      color: #b00000;
      margin-bottom: 20px;
    }
    .timer {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .imgwrap img {
      max-width: 100%;
      border-radius: 10px;
      border: 1px solid #eee;
    }
    .question {
      display: flex;
      align-items: center;
      margin: 8px 0;
      gap: 10px;
    }
    .question label {
      width: 70px;
      font-weight: bold;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      text-transform: uppercase;
    }
    button {
      padding: 10px 15px;
      font-size: 15px;
      cursor: pointer;
    }
    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .ok { color: #0a7a0a; font-weight: bold; }
    .bad { color: #b00000; font-weight: bold; }
  </style>
</head>

<body>

<h2>üéß IELTS LISTENING ‚Äì 40 QUESTIONS</h2>
<div class="note">
  [Please write your answers in ALL CAPITAL LETTERS for them to be counted.]
</div>

<div class="timer">‚è± Time left: <span id="time">40:00</span></div>

<div class="card">
  <h3>üéß Listening Audio</h3>
  <audio controls style="width:100%">
    <source src="./assets/audio.mp3" type="audio/mpeg">
    Your browser does not support audio.
  </audio>
</div>

<div id="sections"></div>

<div class="card">
  <div class="actions">
    <button onclick="submitTest()">SUBMIT</button>
    <button onclick="clearAll()">CLEAR ALL</button>
  </div>
  <div id="status"></div>
</div>

<script>
  /* ===== C·∫§U H√åNH ===== */
  const IMAGE_PATHS = [
    "./assets/img/1.png",
    "./assets/img/2.png",
    "./assets/img/3.png",
    "./assets/img/4.png",
    "./assets/img/5.png",
    "./assets/img/6.png",
    "./assets/img/7.png",
    "./assets/img/8.png"
  ];

  const QUESTIONS_PER_IMAGE = 5;
  const TOTAL_QUESTIONS = 40;
  const TIME_LIMIT = 40 * 60; // gi√¢y

  /* ===== BUILD UI ===== */
  const container = document.getElementById("sections");
  let q = 1;

  for (let block = 0; block < 8; block++) {
    const start = q;
    const end = q + QUESTIONS_PER_IMAGE - 1;

    const card = document.createElement("div");
    card.className = "card";

    const title = document.createElement("h3");
    title.textContent = `Questions ${start}‚Äì${end}`;
    card.appendChild(title);

    const imgWrap = document.createElement("div");
    imgWrap.className = "imgwrap";
    const img = document.createElement("img");
    img.src = IMAGE_PATHS[block];
    imgWrap.appendChild(img);
    card.appendChild(imgWrap);

    for (let i = 0; i < QUESTIONS_PER_IMAGE; i++) {
      const row = document.createElement("div");
      row.className = "question";

      const label = document.createElement("label");
      label.textContent = `Q${q}:`;
      row.appendChild(label);

      const input = document.createElement("input");
      input.type = "text";
      input.required = true;
      input.oninput = () => {
        input.value = input.value.toUpperCase().replace(/[^A-Z]/g, "");
      };

      row.appendChild(input);
      card.appendChild(row);
      q++;
    }

    container.appendChild(card);
  }

  /* ===== TIMER ===== */
  let remaining = TIME_LIMIT;
  const timeEl = document.getElementById("time");

  function tick() {
    const m = Math.floor(remaining / 60);
    const s = remaining % 60;
    timeEl.textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    if (remaining <= 0) {
      submitTest(true);
      return;
    }
    remaining--;
    setTimeout(tick, 1000);
  }
  tick();

  /* ===== SUBMIT ===== */
  function submitTest(auto=false) {
    const inputs = document.querySelectorAll("input");
    for (let i = 0; i < inputs.length; i++) {
      if (!inputs[i].value) {
        document.getElementById("status").innerHTML =
          `<span class="bad">Please answer Question ${i+1}</span>`;
        return;
      }
    }
    document.getElementById("status").innerHTML =
      `<span class="ok">${auto ? "Time up. " : ""}Answers submitted successfully.</span>`;
  }

  function clearAll() {
    if (!confirm("Clear all answers?")) return;
    document.querySelectorAll("input").forEach(i => i.value = "");
    document.getElementById("status").innerHTML = "";
  }
</script>

</body>
</html>
